/**
 * User: Soezen
 * Date: 31/10/13
 * Time: 20:47
 */
var logger = require('./logger');
var fs = require('fs');
var path = require('path');

function loadFile(response, folder, filename, ext) {

    fs.readFile(folder + filename, function(error, html) {
        response.writeHeader(200, {"Content-Type": "text/" + ext});
        if (error) {
            response.write("ERROR: " + error);
        } else {
            response.write(html);
        }
        response.end();
    });
}

function route(pathname, handle, request, response) {
    logger.log('routing: ' + pathname);

    var ext = path.extname(pathname);
    switch (ext) {
        case '.css':
            loadFile(response, 'app/resources/css', pathname, 'css');
            break;
        case '.js':
            loadFile(response, 'app/resources/js', pathname, 'js');
            break;
        case '.html':
            loadFile(response, 'app/resources/html', pathname, 'html');
            break;
        default:
            if (typeof handle[pathname] === 'function') {
                return handle[pathname](request, response);
            } else {
                response.writeHead(404, {
                    "Content-Type": "text/html"
                });
                response.write('404 Not found');
                response.end();
            }
    }
}

exports.route = route;